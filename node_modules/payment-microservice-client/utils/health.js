"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.healthCheck = exports.onAlive = exports.emitInTime = exports.initAliveInterval = void 0;
const out_1 = require("./out");
const socket_1 = require("./socket");
let isAlive = true;
const kill = () => {
    out_1.default.info(`No alive received in last 2 minutes, killing pod`);
    isAlive = false;
};
let aliveInterval;
const initAliveInterval = () => {
    aliveInterval = setTimeout(() => {
        kill();
    }, 1000 * 60 * 2);
};
exports.initAliveInterval = initAliveInterval;
const emitInTime = (server) => {
    out_1.default.debug(`Emitting health check...`);
    server.to(socket_1.paymentRoomId).emit('healthCheck');
    setTimeout(() => (0, exports.emitInTime)(server), 1000 * 60 * 1);
};
exports.emitInTime = emitInTime;
const onAlive = () => {
    out_1.default.debug(`Received alive, clearing interval`);
    clearTimeout(aliveInterval);
    aliveInterval = setTimeout(() => {
        kill();
    }, 1000 * 60 * 2);
};
exports.onAlive = onAlive;
const healthCheck = (_, res) => {
    if (isAlive) {
        res.status(200).end();
    }
    else {
        res.status(500).end();
    }
};
exports.healthCheck = healthCheck;
//# sourceMappingURL=health.js.map